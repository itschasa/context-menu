{"version":3,"file":"context-menu.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/context-menu.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import './styles.less';\r\n\r\nconst instances = [];\r\nlet nextId = 0;\r\n\r\n// Tiny polyfill for Element.matches() for IE\r\nif (!Element.prototype.matches) {\r\n  Element.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n\r\n// Gets an element's next/previous sibling that matches the given selector\r\nfunction getSibling(el, selector, direction = 1) {\r\n  const sibling =\r\n    direction > 0 ? el.nextElementSibling : el.previousElementSibling;\r\n  if (!sibling || sibling.matches(selector)) {\r\n    return sibling;\r\n  }\r\n  return getSibling(sibling, selector, direction);\r\n}\r\n\r\n// Fires custom event on given element\r\nfunction emit(el, type, data = {}) {\r\n  const event = document.createEvent('Event');\r\n\r\n  Object.keys(data).forEach((key) => {\r\n    event[key] = data[key];\r\n  });\r\n\r\n  event.initEvent(type, true, true);\r\n  el.dispatchEvent(event);\r\n}\r\n\r\nexport default class ContextMenu {\r\n  constructor(\r\n    selector,\r\n    items,\r\n    options = {\r\n      className: '',\r\n      minimalStyling: false,\r\n    },\r\n  ) {\r\n    this.selector = selector;\r\n    this.items = items;\r\n    this.options = options;\r\n    this.id = nextId++;\r\n    this.target = null;\r\n\r\n    this.create();\r\n    instances.push(this);\r\n  }\r\n\r\n  // Creates DOM elements, sets up event listeners\r\n  create() {\r\n    // Create root <ul>\r\n    this.menu = document.createElement('ul');\r\n    this.menu.className = 'ContextMenu';\r\n    this.menu.setAttribute('data-contextmenu', this.id);\r\n    this.menu.setAttribute('tabindex', -1);\r\n    this.menu.addEventListener('keyup', (e) => {\r\n      switch (e.which) {\r\n        case 38:\r\n          this.moveFocus(-1);\r\n          break;\r\n        case 40:\r\n          this.moveFocus(1);\r\n          break;\r\n        case 27:\r\n          this.hide();\r\n          break;\r\n        default:\r\n        // do nothing\r\n      }\r\n    });\r\n\r\n    if (!this.options.minimalStyling) {\r\n      this.menu.classList.add('ContextMenu--theme-default');\r\n    }\r\n    if (this.options.className) {\r\n      this.options.className\r\n        .split(' ')\r\n        .forEach((cls) => this.menu.classList.add(cls));\r\n    }\r\n\r\n    // Create <li>'s for each menu item\r\n    this.items.forEach((item, index) => {\r\n      const li = document.createElement('li');\r\n\r\n      if (!('name' in item)) {\r\n        // Insert a divider\r\n        li.className = 'ContextMenu-divider';\r\n      } else {\r\n        li.className = 'ContextMenu-item';\r\n        li.textContent = item.name;\r\n        li.setAttribute('data-contextmenuitem', index);\r\n        li.setAttribute('tabindex', 0);\r\n        li.addEventListener('click', this.select.bind(this, li));\r\n        li.addEventListener('keyup', (e) => {\r\n          if (e.which === 13) {\r\n            this.select(li);\r\n          }\r\n        });\r\n      }\r\n\r\n      this.menu.appendChild(li);\r\n    });\r\n\r\n    // Add root element to the <body>\r\n    document.body.appendChild(this.menu);\r\n\r\n    emit(this.menu, 'created');\r\n  }\r\n\r\n  // Shows context menu\r\n  show(e) {\r\n    this.menu.style.left = `${e.pageX}px`;\r\n    this.menu.style.top = `${e.pageY}px`;\r\n    this.menu.classList.add('is-open');\r\n    this.target = e.target;\r\n    // Give context menu focus\r\n    this.menu.focus();\r\n    // Disable native context menu\r\n    e.preventDefault();\r\n\r\n    emit(this.menu, 'shown');\r\n  }\r\n\r\n  // Hides context menu\r\n  hide() {\r\n    this.menu.classList.remove('is-open');\r\n    this.target = null;\r\n    emit(this.menu, 'hidden');\r\n  }\r\n\r\n  // Selects the given item and calls its handler\r\n  select(item) {\r\n    const itemId = item.getAttribute('data-contextmenuitem');\r\n    if (this.items[itemId]) {\r\n      // Call item handler with target element as parameter\r\n      this.items[itemId].fn(this.target);\r\n    }\r\n    this.hide();\r\n    emit(this.menu, 'itemselected');\r\n  }\r\n\r\n  // Moves focus to the next/previous menu item\r\n  moveFocus(direction = 1) {\r\n    const focused = this.menu.querySelector('[data-contextmenuitem]:focus');\r\n    let next;\r\n\r\n    if (focused) {\r\n      next = getSibling(focused, '[data-contextmenuitem]', direction);\r\n    }\r\n\r\n    if (!next) {\r\n      next =\r\n        direction > 0\r\n          ? this.menu.querySelector('[data-contextmenuitem]:first-child')\r\n          : this.menu.querySelector('[data-contextmenuitem]:last-child');\r\n    }\r\n\r\n    if (next) next.focus();\r\n  }\r\n\r\n  // Convenience method for adding an event listener\r\n  on(type, fn) {\r\n    this.menu.addEventListener(type, fn);\r\n  }\r\n\r\n  // Convenience method for removing an event listener\r\n  off(type, fn) {\r\n    this.menu.removeEventListener(type, fn);\r\n  }\r\n\r\n  // Removes DOM elements, stop listeners\r\n  destroy() {\r\n    this.menu.parentElement.removeChild(this.menu);\r\n    this.menu = null;\r\n    instances.splice(instances.indexOf(this), 1);\r\n  }\r\n}\r\n\r\n// Listen for contextmenu event to show menu\r\ndocument.addEventListener('contextmenu', (e) => {\r\n  instances.forEach((menu) => {\r\n    var counter = 0;\r\n    var target = e.target;\r\n    while (counter < 5) {\r\n      if (target.matches(menu.selector)) {\r\n        menu.show(e);\r\n        break;\r\n      } else {\r\n        target = target.parentElement;\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\n// Listen for click event to hide menu\r\ndocument.addEventListener('click', (e) => {\r\n  instances.forEach((menu) => {\r\n    if (\r\n      !e.target.matches(\r\n        `[data-contextmenu=\"${menu.id}\"], [data-contextmenu=\"${menu.id}\"] *`,\r\n      )\r\n    ) {\r\n      menu.hide();\r\n    }\r\n  });\r\n});\r\n"],"names":["css","ref","head","insertAt","document","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","const","instances","nextId","emit","el","data","event","createEvent","Object","keys","forEach","key","initEvent","dispatchEvent","Element","prototype","matches","msMatchesSelector","ContextMenu","selector","items","options","className","minimalStyling","this","id","target","create","push","menu","setAttribute","addEventListener","e","which","moveFocus","hide","classList","add","split","cls","item","index","li","textContent","name","select","bind","body","show","left","top","focus","preventDefault","remove","itemId","getAttribute","fn","direction","next","focused","querySelector","getSibling","sibling","nextElementSibling","previousElementSibling","on","off","removeEventListener","destroy","parentElement","removeChild","splice","indexOf"],"mappings":"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"}